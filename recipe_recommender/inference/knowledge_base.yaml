# Knowledge Base for Recipe Recommendation System
# TRUE FORWARD-CHAINING INFERENCE
#
# KEY DIFFERENCE FROM FILTERING:
# - OLD (filtering): IF condition THEN remove recipe from list
# - NEW (forward-chaining): IF condition THEN assert new fact
#
# Forward-chaining derives new knowledge iteratively:
# 1. Start with initial facts (user allergies, recipe ingredients, etc.)
# 2. Apply rules to derive new facts (recipe_unsuitable, needs_substitution, etc.)
# 3. Repeat until no new facts can be derived (fixed point)
# 4. Use final facts to make recommendations
#
# Action types:
# - assert: Assert new facts into working memory
# - set_recipe_fact: Set a specific fact about a recipe
# - add_to_list: Add item to a list fact (e.g., exclusion_reasons)
# - modify_score: Change recommendation score
# - add_substitution: Suggest ingredient substitution

metadata:
  name: Recipe Recommendation Knowledge Base
  version: 2.0
  description: Forward-chaining rules for recipe recommendations
  expert: Professional Chef and Nutritionist
  total_rules: 106

rules:
  # ============================================================================
  # ALLERGY SAFETY RULES
  # Priority 100 - Critical safety rules
  # ============================================================================
  
  - id: R001
    name: Detect nut allergy conflict
    description: If user allergic to nuts AND recipe contains nuts, mark unsuitable
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(nuts)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['nuts']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R002
    name: Add nut allergy exclusion reason
    description: If recipe marked unsuitable due to nuts, add reason
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(nuts)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['nuts']
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Contains nuts (allergen)
  
  - id: R003
    name: Detect dairy allergy conflict
    description: If user allergic to dairy AND recipe contains dairy, mark unsuitable
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(dairy)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['dairy', 'milk', 'cheese', 'butter', 'cream']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R004
    name: Add dairy allergy exclusion reason
    description: Add exclusion reason for dairy allergy
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(dairy)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Contains dairy (allergen)
  
  - id: R005
    name: Detect gluten allergy conflict
    description: If user allergic to gluten AND recipe contains gluten, mark unsuitable
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(gluten)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['flour', 'wheat', 'bread', 'pasta']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R006
    name: Add gluten allergy exclusion reason
    description: Add exclusion reason for gluten allergy
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(gluten)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Contains gluten (allergen)
  
  - id: R007
    name: Detect egg allergy conflict
    description: If user allergic to eggs AND recipe contains eggs, mark unsuitable
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(eggs)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['eggs', 'egg']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  # ============================================================================
  # DIETARY PREFERENCE RULES
  # Priority 90 - Diet compatibility
  # ============================================================================
  
  - id: R010
    name: Vegan cannot eat meat
    description: If user is vegan AND recipe contains meat, mark unsuitable
    priority: 90
    category: diet
    conditions:
      - type: fact
        fact: user_diet(vegan)
      - type: attribute
        object: recipe
        attribute: diet
        operator: "!="
        value: vegan
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R011
    name: Add vegan diet exclusion
    description: Add reason for vegan diet incompatibility
    priority: 90
    category: diet
    conditions:
      - type: fact
        fact: user_diet(vegan)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Not vegan-friendly
  
  - id: R012
    name: Vegetarian cannot eat meat
    description: If user is vegetarian AND recipe contains meat, mark unsuitable
    priority: 90
    category: diet
    conditions:
      - type: fact
        fact: user_diet(vegetarian)
      - type: attribute
        object: recipe
        attribute: diet
        operator: not_in
        value: ['vegan', 'vegetarian']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R013
    name: Add vegetarian diet exclusion
    description: Add reason for vegetarian diet incompatibility
    priority: 90
    category: diet
    conditions:
      - type: fact
        fact: user_diet(vegetarian)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Not vegetarian-friendly
  
  # ============================================================================
  # EQUIPMENT AVAILABILITY RULES
  # Priority 80 - Can user prepare this?
  # ============================================================================
  
  - id: R020
    name: Check oven availability
    description: If recipe needs oven AND user lacks oven, mark unprepareble
    priority: 80
    category: equipment
    conditions:
      - type: attribute
        object: recipe
        attribute: cooking_methods
        operator: contains
        value: oven
      - type: fact
        fact: has_equipment(oven)
        operator: ==
        value: False
    action:
      type: set_recipe_fact
      fact_name: can_prepare
      value: False
  
  - id: R021
    name: Add oven exclusion
    description: Add reason for missing oven
    priority: 80
    category: equipment
    conditions:
      - type: recipe_fact
        fact_name: can_prepare
        operator: ==
        value: False
      - type: attribute
        object: recipe
        attribute: cooking_methods
        operator: contains
        value: oven
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Requires oven (not available)
  
  - id: R022
    name: Check grill availability
    description: If recipe needs grill AND user lacks grill, mark unpreparable
    priority: 80
    category: equipment
    conditions:
      - type: attribute
        object: recipe
        attribute: cooking_methods
        operator: contains
        value: grill
      - type: fact
        fact: has_equipment(grill)
        operator: ==
        value: False
    action:
      type: set_recipe_fact
      fact_name: can_prepare
      value: False
  
  - id: R023
    name: Check blender availability
    description: If recipe needs blender AND user lacks blender, mark unpreparable
    priority: 80
    category: equipment
    conditions:
      - type: attribute
        object: recipe
        attribute: cooking_methods
        operator: contains
        value: blender
      - type: fact
        fact: has_equipment(blender)
        operator: ==
        value: False
    action:
      type: set_recipe_fact
      fact_name: can_prepare
      value: False
  
  # ============================================================================
  # SKILL LEVEL RULES
  # Priority 70 - Is recipe too complex?
  # ============================================================================
  
  - id: R030
    name: Beginner cannot cook advanced recipes
    description: If user is beginner AND recipe is advanced, mark inappropriate
    priority: 70
    category: skill
    conditions:
      - type: fact
        fact: user_skill_level(beginner)
      - type: attribute
        object: recipe
        attribute: skill
        operator: in
        value: ['medium', 'advanced', 'experienced']
    action:
      type: set_recipe_fact
      fact_name: skill_appropriate
      value: False
  
  - id: R031
    name: Add skill level exclusion
    description: Add reason for skill mismatch
    priority: 70
    category: skill
    conditions:
      - type: recipe_fact
        fact_name: skill_appropriate
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Recipe too complex for skill level
  
  - id: R032
    name: Intermediate cannot cook very advanced recipes
    description: If user is intermediate AND recipe is advanced, mark inappropriate
    priority: 70
    category: skill
    conditions:
      - type: fact
        fact: user_skill_level(intermediate)
      - type: attribute
        object: recipe
        attribute: skill
        operator: ==
        value: advanced
    action:
      type: set_recipe_fact
      fact_name: skill_appropriate
      value: False
  
  # ============================================================================
  # BUDGET RULES
  # Priority 60 - Can user afford this?
  # ============================================================================
  
  - id: R040
    name: Check recipe cost
    description: If recipe cost exceeds user budget, mark unaffordable
    priority: 60
    category: budget
    conditions:
      - type: attribute
        object: recipe
        attribute: cost
        operator: '>'
        value: 0
      - type: attribute
        object: user
        attribute: budget
        operator: '<'
        value: recipe.cost
    action:
      type: set_recipe_fact
      fact_name: affordable
      value: False
  
  - id: R041
    name: Add budget exclusion
    description: Add reason for exceeding budget
    priority: 60
    category: budget
    conditions:
      - type: recipe_fact
        fact_name: affordable
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Exceeds budget
  
  # ============================================================================
  # SCORING RULES (Positive recommendations)
  # Priority 50 - Boost scores for good matches
  # ============================================================================
  
  - id: R050
    name: Boost cuisine preference match
    description: If recipe cuisine matches user preference, increase score
    priority: 50
    category: scoring
    conditions:
      - type: attribute
        object: user
        attribute: cuisine_preferences
        operator: contains
        value: recipe.cuisine
    action:
      type: modify_score
      delta: 10
  
  - id: R051
    name: Boost easy recipes for beginners
    description: Beginners prefer easy recipes
    priority: 50
    category: scoring
    conditions:
      - type: fact
        fact: user_skill_level(beginner)
      - type: attribute
        object: recipe
        attribute: skill
        operator: ==
        value: easy
    action:
      type: modify_score
      delta: 15
  
  - id: R052
    name: Boost high protein for health goals
    description: If user wants high protein AND recipe is high protein, boost score
    priority: 50
    category: scoring
    conditions:
      - type: attribute
        object: user
        attribute: health_goals
        operator: contains
        value: high-protein
      - type: attribute
        object: recipe
        attribute: macros
        operator: contains
        value: high protein
    action:
      type: modify_score
      delta: 20
  
  - id: R053
    name: Boost low carb for health goals
    description: If user wants low carb AND recipe is low carb, boost score
    priority: 50
    category: scoring
    conditions:
      - type: attribute
        object: user
        attribute: health_goals
        operator: contains
        value: low-carb
      - type: attribute
        object: recipe
        attribute: macros
        operator: contains
        value: low carbs
    action:
      type: modify_score
      delta: 20
  
  - id: R054
    name: Boost budget-friendly recipes
    description: If recipe is low cost, boost score
    priority: 50
    category: scoring
    conditions:
      - type: attribute
        object: recipe
        attribute: budget
        operator: ==
        value: low_cost
    action:
      type: modify_score
      delta: 5
  
  - id: R055
    name: Boost quick meals
    description: If recipe is quick to make, boost score
    priority: 50
    category: scoring
    conditions:
      - type: attribute
        object: recipe
        attribute: cooking_time
        operator: ==
        value: less than 15 minutes
    action:
      type: modify_score
      delta: 8
  
  # ============================================================================
  # SUBSTITUTION RULES
  # Priority 40 - Suggest alternatives
  # ============================================================================
  
  - id: R060
    name: Suggest dairy-free milk
    description: If user allergic to dairy AND recipe has milk, suggest alternative
    priority: 40
    category: substitution
    conditions:
      - type: fact
        fact: user_allergic_to(dairy)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['milk']
    action:
      type: add_substitution
      ingredient: milk
      substitute: almond milk or oat milk
  
  - id: R061
    name: Suggest gluten-free flour
    description: If user allergic to gluten AND recipe has flour, suggest alternative
    priority: 40
    category: substitution
    conditions:
      - type: fact
        fact: user_allergic_to(gluten)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['flour']
    action:
      type: add_substitution
      ingredient: flour
      substitute: gluten-free flour or almond flour
  
  - id: R062
    name: Suggest egg substitute
    description: If user allergic to eggs AND recipe has eggs, suggest alternative
    priority: 40
    category: substitution
    conditions:
      - type: fact
        fact: user_allergic_to(eggs)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['eggs']
    action:
      type: add_substitution
      ingredient: eggs
      substitute: flax eggs or chia eggs
  
  # ============================================================================
  # MORE ALLERGY SAFETY RULES (Shellfish, Fish, Soy, Sesame, Peanuts, Tree Nuts)
  # ============================================================================
  
  - id: R070
    name: Detect shellfish allergy conflict
    description: If user allergic to shellfish AND recipe contains shellfish, mark unsuitable
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(shellfish)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['shrimp', 'crab', 'lobster', 'shellfish']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R071
    name: Add shellfish allergy exclusion
    description: Add exclusion reason for shellfish allergy
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(shellfish)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Contains shellfish (allergen)
  
  - id: R072
    name: Detect fish allergy conflict
    description: If user allergic to fish AND recipe contains fish, mark unsuitable
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(fish)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['fish', 'salmon', 'tuna', 'trout']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R073
    name: Add fish allergy exclusion
    description: Add exclusion reason for fish allergy
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(fish)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Contains fish (allergen)
  
  - id: R074
    name: Detect soy allergy conflict
    description: If user allergic to soy AND recipe contains soy, mark unsuitable
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(soy)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['soy', 'tofu', 'soy sauce']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R075
    name: Add soy allergy exclusion
    description: Add exclusion reason for soy allergy
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(soy)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Contains soy (allergen)
  
  - id: R076
    name: Detect sesame allergy conflict
    description: If user allergic to sesame AND recipe contains sesame, mark unsuitable
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(sesame)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['sesame', 'tahini']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R077
    name: Add sesame allergy exclusion
    description: Add exclusion reason for sesame allergy
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(sesame)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Contains sesame (allergen)
  
  - id: R078
    name: Detect peanut allergy conflict
    description: If user allergic to peanuts AND recipe contains peanuts, mark unsuitable
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(peanuts)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['peanuts', 'peanut butter']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R079
    name: Add peanut allergy exclusion
    description: Add exclusion reason for peanut allergy
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(peanuts)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Contains peanuts (allergen)
  
  - id: R080
    name: Detect tree nut allergy conflict
    description: If user allergic to tree nuts AND recipe contains tree nuts, mark unsuitable
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(tree nuts)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['almonds', 'walnuts', 'cashews', 'pecans', 'hazelnuts']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R081
    name: Add tree nut allergy exclusion
    description: Add exclusion reason for tree nut allergy
    priority: 100
    category: safety
    conditions:
      - type: fact
        fact: user_allergic_to(tree nuts)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Contains tree nuts (allergen)
  
  # ============================================================================
  # DIETARY RESTRICTION RULES (Gluten-Free, Dairy-Free, Low-Carb)
  # ============================================================================
  
  - id: R090
    name: Gluten-free restriction check
    description: If user needs gluten-free AND recipe contains gluten, mark unsuitable
    priority: 95
    category: diet_restriction
    conditions:
      - type: fact
        fact: user_diet(gluten-free)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['flour', 'wheat', 'bread', 'pasta']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R091
    name: Add gluten-free restriction exclusion
    description: Add exclusion reason for gluten-free restriction
    priority: 95
    category: diet_restriction
    conditions:
      - type: fact
        fact: user_diet(gluten-free)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Contains gluten (dietary restriction)
  
  - id: R092
    name: Dairy-free restriction check
    description: If user needs dairy-free AND recipe contains dairy, mark unsuitable
    priority: 95
    category: diet_restriction
    conditions:
      - type: fact
        fact: user_diet(dairy-free)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_ingredient
        args: ['dairy', 'milk', 'cheese', 'butter', 'cream']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R093
    name: Add dairy-free restriction exclusion
    description: Add exclusion reason for dairy-free restriction
    priority: 95
    category: diet_restriction
    conditions:
      - type: fact
        fact: user_diet(dairy-free)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Contains dairy (dietary restriction)
  
  - id: R094
    name: Low-carb restriction check
    description: If user wants low-carb AND recipe is high-carb, reduce score
    priority: 85
    category: diet_restriction
    conditions:
      - type: fact
        fact: user_diet(low-carb)
      - type: attribute
        object: recipe
        attribute: nutritional_info
        operator: method_call
        method: get_carbs
        args: []
        comparison: '>'
        value: 30
    action:
      type: modify_score
      delta: -15
  
  - id: R095
    name: Pescatarian diet compatibility
    description: If user is pescatarian AND recipe has meat (not fish), mark unsuitable
    priority: 90
    category: diet
    conditions:
      - type: fact
        fact: user_diet(pescatarian)
      - type: attribute
        object: recipe
        attribute: diet
        operator: not_in
        value: ['vegan', 'vegetarian', 'pescatarian']
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R096
    name: Add pescatarian diet exclusion
    description: Add reason for pescatarian diet incompatibility
    priority: 90
    category: diet
    conditions:
      - type: fact
        fact: user_diet(pescatarian)
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Contains meat (not pescatarian-friendly)
  
  # ============================================================================
  # MORE EQUIPMENT RULES
  # ============================================================================
  
  - id: R100
    name: Check food processor availability
    description: If recipe needs food processor AND user lacks it, mark unpreparable
    priority: 80
    category: equipment
    conditions:
      - type: attribute
        object: recipe
        operator: method_call
        method: needs_equipment
        args: ['food processor']
      - type: fact
        fact: has_equipment(food processor)
        operator: ==
        value: False
    action:
      type: set_recipe_fact
      fact_name: can_prepare
      value: False
  
  - id: R101
    name: Check mixer availability
    description: If recipe needs mixer AND user lacks mixer, mark unpreparable
    priority: 80
    category: equipment
    conditions:
      - type: attribute
        object: recipe
        operator: method_call
        method: needs_equipment
        args: ['mixer']
      - type: fact
        fact: has_equipment(mixer)
        operator: ==
        value: False
    action:
      type: set_recipe_fact
      fact_name: can_prepare
      value: False
  
  - id: R102
    name: Check slow cooker availability
    description: If recipe needs slow cooker AND user lacks it, mark unpreparable
    priority: 80
    category: equipment
    conditions:
      - type: attribute
        object: recipe
        operator: method_call
        method: needs_equipment
        args: ['slow cooker']
      - type: fact
        fact: has_equipment(slow cooker)
        operator: ==
        value: False
    action:
      type: set_recipe_fact
      fact_name: can_prepare
      value: False
  
  - id: R103
    name: Check air fryer availability
    description: If recipe needs air fryer AND user lacks it, mark unpreparable
    priority: 80
    category: equipment
    conditions:
      - type: attribute
        object: recipe
        operator: method_call
        method: needs_equipment
        args: ['air fryer']
      - type: fact
        fact: has_equipment(air fryer)
        operator: ==
        value: False
    action:
      type: set_recipe_fact
      fact_name: can_prepare
      value: False
  
  - id: R104
    name: Check stand mixer availability
    description: If recipe needs stand mixer AND user lacks it, mark unpreparable
    priority: 80
    category: equipment
    conditions:
      - type: attribute
        object: recipe
        operator: method_call
        method: needs_equipment
        args: ['stand mixer']
      - type: fact
        fact: has_equipment(stand mixer)
        operator: ==
        value: False
    action:
      type: set_recipe_fact
      fact_name: can_prepare
      value: False
  
  # ============================================================================
  # HEALTH GOAL RULES
  # ============================================================================
  
  - id: R110
    name: Weight loss goal - low calorie
    description: If user wants weight loss AND recipe is low calorie, boost score
    priority: 50
    category: health
    conditions:
      - type: fact
        fact: user_health_goal(weight-loss)
      - type: attribute
        object: recipe
        attribute: nutritional_info
        operator: method_call
        method: get_calories
        args: []
        comparison: '<='
        value: 350
    action:
      type: modify_score
      delta: 25
  
  - id: R111
    name: Weight loss goal - high calorie penalty
    description: If user wants weight loss AND recipe is high calorie, reduce score
    priority: 50
    category: health
    conditions:
      - type: fact
        fact: user_health_goal(weight-loss)
      - type: attribute
        object: recipe
        attribute: nutritional_info
        operator: method_call
        method: get_calories
        args: []
        comparison: '>'
        value: 500
    action:
      type: modify_score
      delta: -20
  
  - id: R112
    name: Muscle gain goal - high protein
    description: If user wants muscle gain AND recipe is high protein, boost score
    priority: 50
    category: health
    conditions:
      - type: fact
        fact: user_health_goal(muscle-gain)
      - type: attribute
        object: recipe
        attribute: nutritional_info
        operator: method_call
        method: get_protein
        args: []
        comparison: '>='
        value: 25
    action:
      type: modify_score
      delta: 25
  
  - id: R113
    name: Muscle gain goal - low protein penalty
    description: If user wants muscle gain AND recipe is low protein, reduce score
    priority: 50
    category: health
    conditions:
      - type: fact
        fact: user_health_goal(muscle-gain)
      - type: attribute
        object: recipe
        attribute: nutritional_info
        operator: method_call
        method: get_protein
        args: []
        comparison: '<'
        value: 15
    action:
      type: modify_score
      delta: -15
  
  - id: R114
    name: Heart health goal - low fat
    description: If user wants heart health AND recipe is low fat, boost score
    priority: 50
    category: health
    conditions:
      - type: fact
        fact: user_health_goal(heart-health)
      - type: attribute
        object: recipe
        attribute: nutritional_info
        operator: method_call
        method: get_fat
        args: []
        comparison: '<='
        value: 15
    action:
      type: modify_score
      delta: 20
  
  - id: R115
    name: Heart health goal - high fat penalty
    description: If user wants heart health AND recipe is high fat, reduce score
    priority: 50
    category: health
    conditions:
      - type: fact
        fact: user_health_goal(heart-health)
      - type: attribute
        object: recipe
        attribute: nutritional_info
        operator: method_call
        method: get_fat
        args: []
        comparison: '>'
        value: 25
    action:
      type: modify_score
      delta: -18
  
  - id: R116
    name: Blood sugar control - low carb
    description: If user wants blood sugar control AND recipe is low carb, boost score
    priority: 50
    category: health
    conditions:
      - type: fact
        fact: user_health_goal(blood-sugar-control)
      - type: attribute
        object: recipe
        attribute: nutritional_info
        operator: method_call
        method: get_carbs
        args: []
        comparison: '<='
        value: 25
    action:
      type: modify_score
      delta: 22
  
  - id: R117
    name: Energy boost goal - balanced macros
    description: If user wants energy boost AND recipe has balanced macros, boost score
    priority: 50
    category: health
    conditions:
      - type: fact
        fact: user_health_goal(energy-boost)
      - type: attribute
        object: recipe
        attribute: macros
        operator: contains
        value: balanced
    action:
      type: modify_score
      delta: 15
  
  # ============================================================================
  # TIME CONSTRAINT RULES
  # ============================================================================
  
  - id: R120
    name: Quick meal preference
    description: If user prefers quick meals AND recipe takes less than 15 min, boost
    priority: 60
    category: time
    conditions:
      - type: fact
        fact: user_prefers_quick_meals()
      - type: attribute
        object: recipe
        attribute: cook_time
        operator: '<='
        value: 15
    action:
      type: modify_score
      delta: 18
  
  - id: R121
    name: Time constraint violation
    description: If recipe time exceeds user available time, mark unsuitable
    priority: 70
    category: time
    conditions:
      - type: fact
        fact: user_max_cooking_time(X)
      - type: attribute
        object: recipe
        attribute: total_time
        operator: '>'
        value: X
    action:
      type: set_recipe_fact
      fact_name: suitable_for_user
      value: False
  
  - id: R122
    name: Add time constraint exclusion
    description: Add reason for time constraint violation
    priority: 70
    category: time
    conditions:
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: False
      - type: fact
        fact: user_max_cooking_time(X)
    action:
      type: add_to_list
      fact_name: exclusion_reasons
      item: Takes too long to prepare
  
  # ============================================================================
  # CUISINE PREFERENCE RULES
  # ============================================================================
  
  - id: R130
    name: Italian cuisine preference
    description: If user prefers Italian AND recipe is Italian, boost score
    priority: 55
    category: cuisine
    conditions:
      - type: fact
        fact: user_prefers_cuisine(Italian)
      - type: attribute
        object: recipe
        attribute: cuisine
        operator: ==
        value: Italian
    action:
      type: modify_score
      delta: 12
  
  - id: R131
    name: Asian cuisine preference
    description: If user prefers Asian AND recipe is Asian, boost score
    priority: 55
    category: cuisine
    conditions:
      - type: fact
        fact: user_prefers_cuisine(Asian)
      - type: attribute
        object: recipe
        attribute: cuisine
        operator: ==
        value: Asian
    action:
      type: modify_score
      delta: 12
  
  - id: R132
    name: Mexican cuisine preference
    description: If user prefers Mexican AND recipe is Mexican, boost score
    priority: 55
    category: cuisine
    conditions:
      - type: fact
        fact: user_prefers_cuisine(Mexican)
      - type: attribute
        object: recipe
        attribute: cuisine
        operator: ==
        value: Mexican
    action:
      type: modify_score
      delta: 12
  
  - id: R133
    name: French cuisine preference
    description: If user prefers French AND recipe is French, boost score
    priority: 55
    category: cuisine
    conditions:
      - type: fact
        fact: user_prefers_cuisine(French)
      - type: attribute
        object: recipe
        attribute: cuisine
        operator: ==
        value: French
    action:
      type: modify_score
      delta: 12
  
  - id: R134
    name: American cuisine preference
    description: If user prefers American AND recipe is American, boost score
    priority: 55
    category: cuisine
    conditions:
      - type: fact
        fact: user_prefers_cuisine(American)
      - type: attribute
        object: recipe
        attribute: cuisine
        operator: ==
        value: American
    action:
      type: modify_score
      delta: 12
  
  # ============================================================================
  # MEAL TYPE RULES
  # ============================================================================
  
  - id: R140
    name: Breakfast preference match
    description: If user wants breakfast AND recipe is breakfast, boost score
    priority: 60
    category: meal_type
    conditions:
      - type: fact
        fact: user_meal_preference(breakfast)
      - type: attribute
        object: recipe
        attribute: meal
        operator: ==
        value: breakfast
    action:
      type: modify_score
      delta: 20
  
  - id: R141
    name: Lunch preference match
    description: If user wants lunch AND recipe is lunch, boost score
    priority: 60
    category: meal_type
    conditions:
      - type: fact
        fact: user_meal_preference(lunch)
      - type: attribute
        object: recipe
        attribute: meal
        operator: ==
        value: lunch
    action:
      type: modify_score
      delta: 20
  
  - id: R142
    name: Dinner preference match
    description: If user wants dinner AND recipe is dinner, boost score
    priority: 60
    category: meal_type
    conditions:
      - type: fact
        fact: user_meal_preference(dinner)
      - type: attribute
        object: recipe
        attribute: meal
        operator: ==
        value: dinner
    action:
      type: modify_score
      delta: 20
  
  - id: R143
    name: Snack preference match
    description: If user wants snack AND recipe is snack, boost score
    priority: 60
    category: meal_type
    conditions:
      - type: fact
        fact: user_meal_preference(snack)
      - type: attribute
        object: recipe
        attribute: meal
        operator: ==
        value: snack
    action:
      type: modify_score
      delta: 20
  
  # ============================================================================
  # COOKING METHOD PREFERENCE RULES
  # ============================================================================
  
  - id: R150
    name: Baking preference
    description: If user prefers baking AND recipe uses baking, boost score
    priority: 45
    category: cooking_method
    conditions:
      - type: fact
        fact: user_prefers_method(baking)
      - type: attribute
        object: recipe
        attribute: cooking_methods
        operator: contains
        value: oven
    action:
      type: modify_score
      delta: 10
  
  - id: R151
    name: Grilling preference
    description: If user prefers grilling AND recipe uses grilling, boost score
    priority: 45
    category: cooking_method
    conditions:
      - type: fact
        fact: user_prefers_method(grilling)
      - type: attribute
        object: recipe
        attribute: cooking_methods
        operator: contains
        value: grill
    action:
      type: modify_score
      delta: 10
  
  - id: R152
    name: Stir-frying preference
    description: If user prefers stir-frying AND recipe uses pan, boost score
    priority: 45
    category: cooking_method
    conditions:
      - type: fact
        fact: user_prefers_method(stir-fry)
      - type: attribute
        object: recipe
        attribute: cooking_methods
        operator: contains
        value: pan
    action:
      type: modify_score
      delta: 10
  
  # ============================================================================
  # SERVING SIZE RULES
  # ============================================================================
  
  - id: R160
    name: Single serving preference
    description: If user wants single serving AND recipe serves 1-2, boost score
    priority: 40
    category: serving
    conditions:
      - type: fact
        fact: user_serving_size(1)
      - type: attribute
        object: recipe
        attribute: servings
        operator: '<='
        value: 2
    action:
      type: modify_score
      delta: 8
  
  - id: R161
    name: Family serving preference
    description: If user wants family serving AND recipe serves 4+, boost score
    priority: 40
    category: serving
    conditions:
      - type: fact
        fact: user_serving_size(4)
      - type: attribute
        object: recipe
        attribute: servings
        operator: '>='
        value: 4
    action:
      type: modify_score
      delta: 8
  
  # ============================================================================
  # SEASONAL AND FRESHNESS RULES
  # ============================================================================
  
  - id: R170
    name: Seasonal ingredient bonus
    description: If recipe uses seasonal ingredients, boost score
    priority: 35
    category: seasonal
    conditions:
      - type: attribute
        object: recipe
        operator: method_call
        method: has_seasonal_ingredients
        args: []
    action:
      type: modify_score
      delta: 7
  
  # ============================================================================
  # COMBINATION RULES (Higher-order inference)
  # ============================================================================
  
  - id: R180
    name: Perfect health match
    description: If recipe meets all user health goals, bonus boost
    priority: 30
    category: combination
    conditions:
      - type: recipe_fact
        fact_name: meets_protein_goal
        operator: ==
        value: True
      - type: recipe_fact
        fact_name: meets_calorie_goal
        operator: ==
        value: True
      - type: recipe_fact
        fact_name: meets_carb_goal
        operator: ==
        value: True
    action:
      type: modify_score
      delta: 30
  
  - id: R181
    name: Beginner-friendly and quick
    description: If recipe is easy AND quick, boost for beginners
    priority: 45
    category: combination
    conditions:
      - type: fact
        fact: user_skill_level(beginner)
      - type: attribute
        object: recipe
        attribute: skill
        operator: ==
        value: easy
      - type: attribute
        object: recipe
        attribute: cook_time
        operator: '<='
        value: 20
    action:
      type: modify_score
      delta: 25
  
  - id: R182
    name: Budget and healthy combo
    description: If recipe is low cost AND healthy, boost score
    priority: 40
    category: combination
    conditions:
      - type: attribute
        object: recipe
        attribute: budget
        operator: ==
        value: low_cost
      - type: attribute
        object: recipe
        attribute: macros
        operator: contains
        value: balanced
    action:
      type: modify_score
      delta: 15
  
  # ============================================================================
  # PENALTY RULES (Negative scoring)
  # ============================================================================
  
  - id: R190
    name: Too expensive penalty
    description: If recipe is expensive, apply penalty
    priority: 55
    category: penalty
    conditions:
      - type: attribute
        object: recipe
        attribute: budget
        operator: ==
        value: expensive
    action:
      type: modify_score
      delta: -10
  
  - id: R191
    name: Very complex recipe penalty
    description: If recipe is very complex, apply small penalty
    priority: 55
    category: penalty
    conditions:
      - type: attribute
        object: recipe
        attribute: skill
        operator: ==
        value: advanced
    action:
      type: modify_score
      delta: -5
  
  - id: R192
    name: Time-intensive penalty
    description: If recipe takes very long, apply penalty
    priority: 55
    category: penalty
    conditions:
      - type: attribute
        object: recipe
        attribute: total_time
        operator: '>'
        value: 120
    action:
      type: modify_score
      delta: -12
  
  # ============================================================================
  # FINAL RECOMMENDATION RULES
  # ============================================================================
  
  - id: R200
    name: Mark as recommended
    description: If recipe is suitable and score is high, mark as recommended
    priority: 10
    category: final
    conditions:
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: True
      - type: recipe_fact
        fact_name: recommendation_score
        operator: '>='
        value: 50
    action:
      type: set_recipe_fact
      fact_name: recommended
      value: True
  
  - id: R201
    name: Mark as highly recommended
    description: If recipe score is very high, mark as highly recommended
    priority: 10
    category: final
    conditions:
      - type: recipe_fact
        fact_name: recommended
        operator: ==
        value: True
      - type: recipe_fact
        fact_name: recommendation_score
        operator: '>='
        value: 80
    action:
      type: set_recipe_fact
      fact_name: highly_recommended
      value: True
  
  - id: R202
    name: Final suitability check
    description: Ensure all critical checks passed before final recommendation
    priority: 5
    category: final
    conditions:
      - type: recipe_fact
        fact_name: suitable_for_user
        operator: ==
        value: True
      - type: recipe_fact
        fact_name: can_prepare
        operator: ==
        value: True
      - type: recipe_fact
        fact_name: affordable
        operator: ==
        value: True
    action:
      type: set_recipe_fact
      fact_name: passes_all_checks
      value: True
  
  # ============================================================================
  # ADDITIONAL SCORING RULES FOR 100+ TOTAL
  # ============================================================================
  
  - id: R203
    name: Mediterranean diet preference
    description: If user prefers Mediterranean AND recipe is Mediterranean, boost
    priority: 55
    category: cuisine
    conditions:
      - type: fact
        fact: user_prefers_cuisine(Mediterranean)
      - type: attribute
        object: recipe
        attribute: cuisine
        operator: ==
        value: Mediterranean
    action:
      type: modify_score
      delta: 12
  
  - id: R204
    name: Indian cuisine preference
    description: If user prefers Indian AND recipe is Indian, boost score
    priority: 55
    category: cuisine
    conditions:
      - type: fact
        fact: user_prefers_cuisine(Indian)
      - type: attribute
        object: recipe
        attribute: cuisine
        operator: ==
        value: Indian
    action:
      type: modify_score
      delta: 12
  
  - id: R205
    name: Vegan recipe boost for vegans
    description: If user is vegan AND recipe is vegan, boost score
    priority: 85
    category: diet
    conditions:
      - type: fact
        fact: user_diet(vegan)
      - type: attribute
        object: recipe
        attribute: diet
        operator: ==
        value: vegan
    action:
      type: modify_score
      delta: 30
  
  - id: R206
    name: Vegetarian recipe boost for vegetarians
    description: If user is vegetarian AND recipe is vegetarian, boost score
    priority: 85
    category: diet
    conditions:
      - type: fact
        fact: user_diet(vegetarian)
      - type: attribute
        object: recipe
        attribute: diet
        operator: in
        value: ['vegan', 'vegetarian']
    action:
      type: modify_score
      delta: 25
  
  - id: R207
    name: Pescatarian recipe boost
    description: If user is pescatarian AND recipe is pescatarian-friendly, boost
    priority: 85
    category: diet
    conditions:
      - type: fact
        fact: user_diet(pescatarian)
      - type: attribute
        object: recipe
        attribute: diet
        operator: in
        value: ['vegan', 'vegetarian', 'pescatarian']
    action:
      type: modify_score
      delta: 25
  
  - id: R208
    name: Comfort food preference
    description: If recipe is comfort food, small boost
    priority: 30
    category: preference
    conditions:
      - type: attribute
        object: recipe
        attribute: meal
        operator: ==
        value: comfort
    action:
      type: modify_score
      delta: 5
  
  - id: R209
    name: Low sodium for heart health
    description: If user wants heart health AND recipe is low sodium, boost
    priority: 50
    category: health
    conditions:
      - type: fact
        fact: user_health_goal(heart-health)
      - type: attribute
        object: recipe
        attribute: nutritional_info
        operator: method_call
        method: get_sodium
        args: []
        comparison: '<='
        value: 300
    action:
      type: modify_score
      delta: 15
  
  - id: R210
    name: High fiber for digestion
    description: If recipe is high fiber, boost for health
    priority: 45
    category: health
    conditions:
      - type: attribute
        object: recipe
        attribute: nutritional_info
        operator: method_call
        method: get_fiber
        args: []
        comparison: '>='
        value: 8
    action:
      type: modify_score
      delta: 10
  
  - id: R211
    name: Keto diet compatibility
    description: If user follows keto AND recipe is keto-friendly, boost
    priority: 90
    category: diet
    conditions:
      - type: fact
        fact: user_diet(keto)
      - type: attribute
        object: recipe
        attribute: macros
        operator: contains
        value: low carbs
    action:
      type: modify_score
      delta: 35
  
  - id: R212
    name: Paleo diet compatibility
    description: If user follows paleo AND recipe is paleo-friendly, boost
    priority: 90
    category: diet
    conditions:
      - type: fact
        fact: user_diet(paleo)
      - type: attribute
        object: recipe
        attribute: diet
        operator: ==
        value: paleo
    action:
      type: modify_score
      delta: 35
  
  - id: R213
    name: Whole30 diet compatibility
    description: If user follows Whole30 AND recipe is Whole30-compliant, boost
    priority: 90
    category: diet
    conditions:
      - type: fact
        fact: user_diet(whole30)
      - type: attribute
        object: recipe
        attribute: diet
        operator: ==
        value: whole30
    action:
      type: modify_score
      delta: 35
  
  - id: R214
    name: Raw food preference
    description: If user prefers raw food AND recipe is raw, boost
    priority: 85
    category: diet
    conditions:
      - type: fact
        fact: user_diet(raw)
      - type: attribute
        object: recipe
        attribute: cooking_methods
        operator: ==
        value: []
    action:
      type: modify_score
      delta: 40
  
  - id: R215
    name: One-pot meal preference
    description: If user prefers easy cleanup AND recipe is one-pot, boost
    priority: 42
    category: convenience
    conditions:
      - type: fact
        fact: user_prefers_easy_cleanup()
      - type: attribute
        object: recipe
        operator: method_call
        method: is_one_pot
        args: []
    action:
      type: modify_score
      delta: 18
  
  - id: R216
    name: Meal prep friendly
    description: If user meal preps AND recipe stores well, boost
    priority: 40
    category: convenience
    conditions:
      - type: fact
        fact: user_meal_preps()
      - type: attribute
        object: recipe
        operator: method_call
        method: stores_well
        args: []
    action:
      type: modify_score
      delta: 15
  
  - id: R217
    name: Freezer-friendly bonus
    description: If recipe can be frozen, small boost
    priority: 35
    category: convenience
    conditions:
      - type: attribute
        object: recipe
        operator: method_call
        method: freezer_friendly
        args: []
    action:
      type: modify_score
      delta: 8
  
  - id: R218
    name: Kid-friendly preference
    description: If user has kids AND recipe is kid-friendly, boost
    priority: 65
    category: family
    conditions:
      - type: fact
        fact: user_has_children()
      - type: attribute
        object: recipe
        operator: method_call
        method: is_kid_friendly
        args: []
    action:
      type: modify_score
      delta: 20
  
  - id: R219
    name: Spicy food preference
    description: If user likes spicy AND recipe is spicy, boost
    priority: 40
    category: preference
    conditions:
      - type: fact
        fact: user_likes_spicy()
      - type: attribute
        object: recipe
        operator: method_call
        method: is_spicy
        args: []
    action:
      type: modify_score
      delta: 12
  
  - id: R220
    name: Anti-inflammatory diet
    description: If user wants anti-inflammatory AND recipe has anti-inflammatory ingredients, boost
    priority: 55
    category: health
    conditions:
      - type: fact
        fact: user_health_goal(anti-inflammatory)
      - type: attribute
        object: recipe
        operator: method_call
        method: has_anti_inflammatory_ingredients
        args: []
    action:
      type: modify_score
      delta: 18
