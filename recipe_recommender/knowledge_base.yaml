# Knowledge Base for Recipe Recommendation System
# Contains rules for forward-chaining inference
#
# FORWARD-CHAINING APPROACH:
# - Rules modify recipe state attributes (suitable_for_user, affordable, etc.)
# - Rules fire iteratively until no changes occur
# - Final recommendations based on recipe state checks
#
# State Attributes:
# - suitable_for_user: bool (False if allergies, diet incompatible, etc.)
# - affordable: bool (False if exceeds budget)
# - can_prepare: bool (False if missing equipment)
# - skill_appropriate: bool (False if too complex)
# - recommendation_score: float (increased by positive scoring rules)
# - exclusion_reasons: List[str] (reasons for exclusion)
# - substitution_suggestions: Dict (ingredient/method alternatives)

rules:
  # ============================================================================
  # FILTERING RULES - Determine if a recipe is suitable for a user
  # ============================================================================
  
  - id: filter_allergy_nuts
    name: Filter recipes with nut allergens
    description: Exclude recipes containing nuts if user is allergic
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Peanuts
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [peanuts]
    action:
      type: filter
      result: false
      reason: Recipe contains peanuts (allergen)
  
  - id: filter_allergy_dairy
    name: Filter recipes with dairy allergens
    description: Exclude recipes containing dairy if user is allergic
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Dairy
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [dairy]
    action:
      type: filter
      result: false
      reason: Recipe contains dairy (allergen)
  
  - id: filter_allergy_milk
    name: Filter recipes with milk
    description: Exclude recipes containing milk if user is allergic to dairy
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Dairy
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [milk]
    action:
      type: filter
      result: false
      reason: Recipe contains milk (dairy allergen)
  
  - id: filter_allergy_cheese
    name: Filter recipes with cheese
    description: Exclude recipes containing cheese if user is allergic to dairy
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Dairy
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [cheese]
    action:
      type: filter
      result: false
      reason: Recipe contains cheese (dairy allergen)
  
  - id: filter_allergy_butter
    name: Filter recipes with butter
    description: Exclude recipes containing butter if user is allergic to dairy
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Dairy
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [butter]
    action:
      type: filter
      result: false
      reason: Recipe contains butter (dairy allergen)
  
  - id: filter_allergy_cream
    name: Filter recipes with cream
    description: Exclude recipes containing cream if user is allergic to dairy
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Dairy
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [cream]
    action:
      type: filter
      result: false
      reason: Recipe contains cream (dairy allergen)
  
  - id: filter_allergy_yogurt
    name: Filter recipes with yogurt
    description: Exclude recipes containing yogurt if user is allergic to dairy
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Dairy
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [yogurt]
    action:
      type: filter
      result: false
      reason: Recipe contains yogurt (dairy allergen)
  
  - id: filter_allergy_eggs
    name: Filter recipes with egg allergens
    description: Exclude recipes containing eggs if user is allergic
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Eggs
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [eggs]
    action:
      type: filter
      result: false
      reason: Recipe contains eggs (allergen)
  
  - id: filter_allergy_shellfish
    name: Filter recipes with shellfish allergens
    description: Exclude recipes containing shellfish if user is allergic
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Shellfish
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [shellfish]
    action:
      type: filter
      result: false
      reason: Recipe contains shellfish (allergen)
  
  - id: filter_allergy_shrimp
    name: Filter recipes with shrimp
    description: Exclude recipes containing shrimp if user is allergic to shellfish
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Shellfish
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [shrimp]
    action:
      type: filter
      result: false
      reason: Recipe contains shrimp (shellfish allergen)
  
  - id: filter_allergy_fish
    name: Filter recipes with fish allergens
    description: Exclude recipes containing fish if user is allergic
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Fish
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [fish]
    action:
      type: filter
      result: false
      reason: Recipe contains fish (allergen)
  
  - id: filter_allergy_peanuts
    name: Filter recipes with peanut allergens
    description: Exclude recipes containing peanuts if user is allergic
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Peanuts
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [peanuts]
    action:
      type: filter
      result: false
      reason: Recipe contains peanuts (allergen)
  
  - id: filter_allergy_tree_nuts
    name: Filter recipes with tree nut allergens
    description: Exclude recipes containing tree nuts if user is allergic
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Tree Nuts
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [tree nuts]
    action:
      type: filter
      result: false
      reason: Recipe contains tree nuts (allergen)
  
  - id: filter_allergy_wheat
    name: Filter recipes with wheat allergens
    description: Exclude recipes containing wheat if user is allergic
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Wheat
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [wheat]
    action:
      type: filter
      result: false
      reason: Recipe contains wheat (allergen)
  
  - id: filter_allergy_wheat_pasta
    name: Filter recipes with pasta (wheat allergy)
    description: Exclude recipes with pasta if user has wheat allergy
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Wheat
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [pasta]
    action:
      type: filter
      result: false
      reason: Recipe contains pasta (wheat allergen)
  
  - id: filter_allergy_wheat_flour
    name: Filter recipes with flour (wheat allergy)
    description: Exclude recipes with flour if user has wheat allergy
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Wheat
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [flour]
    action:
      type: filter
      result: false
      reason: Recipe contains flour (wheat allergen)
  
  - id: filter_allergy_soy
    name: Filter recipes with soy allergens
    description: Exclude recipes containing soy if user is allergic
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Soy
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [soy]
    action:
      type: filter
      result: false
      reason: Recipe contains soy (allergen)
  
  - id: filter_allergy_soy_sauce
    name: Filter recipes with soy sauce
    description: Exclude recipes containing soy sauce if user is allergic to soy
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Soy
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [soy sauce]
    action:
      type: filter
      result: false
      reason: Recipe contains soy sauce (soy allergen)
  
  - id: filter_allergy_sesame
    name: Filter recipes with sesame allergens
    description: Exclude recipes containing sesame if user is allergic
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Sesame
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [sesame]
    action:
      type: filter
      result: false
      reason: Recipe contains sesame (allergen)
  
  # Additional dairy product filters
  - id: filter_allergy_dairy_cheese
    name: Filter recipes with cheese (dairy allergy)
    description: Exclude recipes with cheese if user has dairy allergy
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Dairy
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [cheese]
    action:
      type: filter
      result: false
      reason: Recipe contains cheese (dairy allergen)
  
  - id: filter_allergy_dairy_butter
    name: Filter recipes with butter (dairy allergy)
    description: Exclude recipes with butter if user has dairy allergy
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Dairy
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [butter]
    action:
      type: filter
      result: false
      reason: Recipe contains butter (dairy allergen)
  
  - id: filter_allergy_dairy_parmesan
    name: Filter recipes with parmesan (dairy allergy)
    description: Exclude recipes with parmesan if user has dairy allergy
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Dairy
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [parmesan]
    action:
      type: filter
      result: false
      reason: Recipe contains parmesan (dairy allergen)
  
  - id: filter_allergy_dairy_pecorino
    name: Filter recipes with pecorino (dairy allergy)
    description: Exclude recipes with pecorino if user has dairy allergy
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Dairy
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [pecorino cheese]
    action:
      type: filter
      result: false
      reason: Recipe contains pecorino (dairy allergen)
  
  # Tree nut specific ingredients
  - id: filter_allergy_almond_butter
    name: Filter recipes with almond butter (tree nut allergy)
    description: Exclude recipes with almond butter if user has tree nut allergy
    priority: 100
    category: filtering
    conditions:
      - object: user
        attribute: allergies
        operator: contains
        value: Tree Nuts
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [almond butter]
    action:
      type: filter
      result: false
      reason: Recipe contains almond butter (tree nut allergen)
  
  - id: filter_diet_vegan
    name: Filter non-vegan recipes for vegan users
    description: Exclude non-vegan recipes if user is vegan
    priority: 90
    category: filtering
    conditions:
      - object: user
        attribute: dietary_restrictions
        operator: contains
        value: vegan
      - object: recipe
        attribute: diet
        operator: "!="
        value: vegan
    action:
      type: filter
      result: false
      reason: Recipe is not vegan
  
  - id: filter_diet_vegetarian
    name: Filter non-vegetarian recipes for vegetarian users
    description: Exclude non-vegetarian recipes if user is vegetarian
    priority: 90
    category: filtering
    conditions:
      - object: user
        attribute: dietary_restrictions
        operator: contains
        value: vegetarian
      - object: recipe
        attribute: diet
        operator: not_in
        value: [vegan, vegetarian]
    action:
      type: filter
      result: false
      reason: Recipe is not vegetarian
  
  - id: filter_diet_pescatarian
    name: Filter non-pescatarian recipes for pescatarian users
    description: Exclude recipes with meat if user is pescatarian
    priority: 90
    category: filtering
    conditions:
      - object: user
        attribute: dietary_restrictions
        operator: contains
        value: pescatarian
      - object: recipe
        attribute: diet
        operator: "=="
        value: omnivore
    action:
      type: filter
      result: false
      reason: Recipe contains meat (not pescatarian-friendly)
  
  - id: filter_beginner_skill
    name: Filter medium/experienced recipes for beginners
    description: Beginners should only get easy recipes
    priority: 85
    category: filtering
    conditions:
      - object: user
        attribute: skill_level
        operator: "=="
        value: beginner
      - object: recipe
        attribute: skill
        operator: "!="
        value: easy
    action:
      type: filter
      result: false
      reason: Recipe too difficult for beginner skill level
  
  - id: filter_time_15_minutes
    name: Filter long recipes for 15-minute constraint
    description: Users with 15 minutes should only get quick recipes
    priority: 85
    category: filtering
    conditions:
      - object: user
        attribute: max_cooking_time
        operator: "<="
        value: 15
      - object: recipe
        attribute: cooking_time
        operator: "!="
        value: less than 15 minutes
    action:
      type: filter
      result: false
      reason: Recipe takes too long (over 15 minutes)
  
  - id: filter_time_30_minutes
    name: Filter very long recipes for 30-minute constraint
    description: Users with 30 minutes should exclude long recipes
    priority: 85
    category: filtering
    conditions:
      - object: user
        attribute: max_cooking_time
        operator: "<="
        value: 30
      - object: recipe
        attribute: cooking_time
        operator: "=="
        value: more than 45 minutes
    action:
      type: filter
      result: false
      reason: Recipe takes too long (over 45 minutes)
  
  - id: filter_disliked_ingredients
    name: Filter recipes with disliked ingredients
    description: Exclude recipes containing ingredients the user dislikes
    priority: 85
    category: filtering
    conditions:
      - object: user
        attribute: disliked_ingredients
        operator: method_call
        method: dislikes_ingredient
        args: [ingredient_name]
    action:
      type: filter
      result: false
      reason: Recipe contains disliked ingredients
  
  - id: filter_cooking_time
    name: Filter recipes exceeding time constraint
    description: Exclude recipes that take longer than user's available time
    priority: 80
    category: filtering
    conditions:
      - object: user
        attribute: max_cooking_time
        operator: not_method_call
        method: within_time_constraint
        args: [prep_time]
    action:
      type: filter
      result: false
      reason: Recipe takes too long to prepare
  
  - id: filter_skill_level
    name: Filter recipes above user skill level
    description: Exclude recipes requiring higher skill than user has
    priority: 75
    category: filtering
    conditions:
      - object: user
        attribute: skill_level
        operator: not_method_call
        method: can_cook_complexity
        args: [recipe_skill]
    action:
      type: filter
      result: false
      reason: Recipe complexity exceeds user skill level
  
  - id: filter_missing_equipment
    name: Filter recipes requiring unavailable equipment
    description: Exclude recipes needing essential equipment user doesn't have
    priority: 70
    category: filtering
    conditions:
      - object: recipe
        attribute: equipment
        operator: method_call
        method: requires_equipment
        args: [equipment_name]
      - object: user
        attribute: available_equipment
        operator: method_call
        method: has_equipment
        args: [equipment_name]
    action:
      type: filter
      result: false
      reason: Recipe requires equipment you don't have
  
  - id: filter_cuisine_preference
    name: Filter non-preferred cuisines
    description: Exclude recipes from cuisines not in user preferences
    priority: 60
    category: filtering
    conditions:
      - object: user
        attribute: cuisine_preferences
        operator: not_method_call
        method: prefers_cuisine
        args: [cuisine]
    action:
      type: filter
      result: false
      reason: Cuisine not in your preferences
  
  - id: filter_health_goals
    name: Filter recipes not matching health goals
    description: Exclude recipes that don't fit user's health goals
    priority: 65
    category: filtering
    conditions:
      - object: user
        attribute: health_goals
        operator: contains
        value: low-carb
      - object: recipe
        attribute: nutritional_info.carbohydrates
        operator: ">"
        value: 30
    action:
      type: filter
      result: false
      reason: Recipe doesn't match low-carb health goal
  
  - id: filter_calorie_target
    name: Filter recipes exceeding calorie target
    description: Exclude recipes with too many calories
    priority: 65
    category: filtering
    conditions:
      - object: user
        attribute: calorie_target
        operator: "!="
        value: null
      - object: recipe
        attribute: nutritional_info.calories
        operator: ">"
        value: 800
    action:
      type: filter
      result: false
      reason: Recipe exceeds calorie target
  
  # ============================================================================
  # SCORING RULES - Rank suitable recipes
  # ============================================================================
  
  - id: score_cuisine_match
    name: Boost score for preferred cuisine
    description: Increase score if recipe matches user's preferred cuisine
    priority: 50
    category: scoring
    conditions:
      - object: user
        attribute: cuisine_preferences
        operator: method_call
        method: prefers_cuisine
        args: [cuisine]
    action:
      type: score
      score_delta: 10
      reason: Matches your preferred cuisine
  
  - id: score_health_goal_match
    name: Boost score for health goal alignment
    description: Increase score if recipe aligns with health goals
    priority: 45
    category: scoring
    conditions:
      - object: user
        attribute: health_goals
        operator: contains
        value: high-protein
      - object: recipe
        attribute: nutritional_info
        operator: method_call
        method: is_high_protein
        args: []
    action:
      type: score
      score_delta: 15
      reason: High protein (matches your health goal)
  
  - id: score_quick_recipe
    name: Boost score for quick recipes
    description: Increase score for recipes under 15 minutes
    priority: 40
    category: scoring
    conditions:
      - object: recipe
        attribute: cooking_time
        operator: "=="
        value: less_than_15
    action:
      type: score
      score_delta: 5
      reason: Quick and easy to prepare
  
  - id: score_beginner_friendly
    name: Boost score for beginner recipes
    description: Increase score for easy recipes for beginners
    priority: 40
    category: scoring
    conditions:
      - object: user
        attribute: skill_level
        operator: "=="
        value: beginner
      - object: recipe
        attribute: skill
        operator: "=="
        value: easy
    action:
      type: score
      score_delta: 8
      reason: Perfect for beginners
  
  - id: score_budget_friendly
    name: Boost score for budget-friendly recipes
    description: Increase score for affordable recipes
    priority: 35
    category: scoring
    conditions:
      - object: recipe
        attribute: budget
        operator: in
        value: [budget, moderate]
    action:
      type: score
      score_delta: 5
      reason: Budget-friendly option
  
  - id: score_low_calorie
    name: Boost score for low-calorie recipes
    description: Increase score for healthy low-calorie options
    priority: 35
    category: scoring
    conditions:
      - object: recipe
        attribute: nutritional_info
        operator: method_call
        method: is_low_calorie
        args: []
    action:
      type: score
      score_delta: 7
      reason: Low calorie and healthy
  
  - id: score_high_fiber
    name: Boost score for high-fiber recipes
    description: Increase score for recipes with good fiber content
    priority: 30
    category: scoring
    conditions:
      - object: recipe
        attribute: nutritional_info
        operator: method_call
        method: is_high_fiber
        args: []
    action:
      type: score
      score_delta: 6
      reason: High in fiber
  
  # ============================================================================
  # SUBSTITUTION RULES - Suggest alternatives for ingredients and methods
  # ============================================================================
  
  - id: sub_dairy_vegan
    name: Substitute dairy for vegan users
    description: Suggest vegan alternatives for dairy ingredients
    priority: 90
    category: substitution
    conditions:
      - object: user
        attribute: dietary_restrictions
        operator: contains
        value: vegan
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [milk]
    action:
      type: substitute
      substitutions:
        ingredient:
          milk: [almond milk, soy milk, oat milk]
          butter: [vegan butter, coconut oil]
          cheese: [vegan cheese, nutritional yeast]
          yogurt: [coconut yogurt, almond yogurt]
      reason: Vegan alternatives for dairy products
  
  - id: sub_meat_vegetarian
    name: Substitute meat for vegetarian users
    description: Suggest vegetarian alternatives for meat
    priority: 90
    category: substitution
    conditions:
      - object: user
        attribute: dietary_restrictions
        operator: contains
        value: vegetarian
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [chicken]
    action:
      type: substitute
      substitutions:
        ingredient:
          chicken: [tofu, tempeh, seitan, mushrooms]
          beef: [lentils, beans, plant-based meat]
          pork: [jackfruit, tempeh]
          fish: [tofu, hearts of palm]
      reason: Vegetarian protein alternatives
  
  - id: sub_gluten_free
    name: Substitute gluten-containing ingredients
    description: Suggest gluten-free alternatives
    priority: 85
    category: substitution
    conditions:
      - object: user
        attribute: dietary_restrictions
        operator: contains
        value: gluten-free
      - object: recipe
        attribute: has_ingredient
        operator: method_call
        method: has_ingredient
        args: [flour]
    action:
      type: substitute
      substitutions:
        ingredient:
          flour: [rice flour, almond flour, gluten-free flour]
          pasta: [rice pasta, corn pasta, zucchini noodles]
          bread: [gluten-free bread, lettuce wraps]
          soy sauce: [tamari, coconut aminos]
      reason: Gluten-free alternatives
  
  - id: sub_cooking_method_oven_to_airfryer
    name: Substitute oven with air fryer
    description: Suggest air fryer as healthier alternative to oven
    priority: 60
    category: substitution
    conditions:
      - object: recipe
        attribute: uses_cooking_method
        operator: method_call
        method: uses_cooking_method
        args: [baking]
      - object: user
        attribute: has_equipment
        operator: method_call
        method: has_equipment
        args: [air fryer]
    action:
      type: substitute
      substitutions:
        cooking_method:
          baking: [air frying (reduce temp by 25Â°F, reduce time by 20%)]
          roasting: [air frying]
      reason: Air fryer available for healthier cooking
  
  - id: sub_cooking_method_grill_to_pan
    name: Substitute grill with grill pan
    description: Indoor alternative for grilling
    priority: 55
    category: substitution
    conditions:
      - object: recipe
        attribute: uses_cooking_method
        operator: method_call
        method: uses_cooking_method
        args: [grilling]
      - object: user
        attribute: has_equipment
        operator: not_contains
        value: grill
    action:
      type: substitute
      substitutions:
        cooking_method:
          grilling: [grill pan on stove, broiling in oven]
      reason: Indoor alternatives for grilling
  
  - id: sub_equipment_food_processor
    name: Substitute food processor
    description: Suggest alternatives when food processor unavailable
    priority: 50
    category: substitution
    conditions:
      - object: recipe
        attribute: requires_equipment
        operator: method_call
        method: requires_equipment
        args: [food processor]
      - object: user
        attribute: has_equipment
        operator: not_contains
        value: food processor
    action:
      type: substitute
      substitutions:
        equipment:
          food processor: [blender, hand chopper, knife and cutting board]
      reason: Alternative equipment for food processing
  
  - id: sub_equipment_stand_mixer
    name: Substitute stand mixer
    description: Suggest alternatives when stand mixer unavailable
    priority: 50
    category: substitution
    conditions:
      - object: recipe
        attribute: requires_equipment
        operator: method_call
        method: requires_equipment
        args: [stand mixer]
      - object: user
        attribute: has_equipment
        operator: not_contains
        value: stand mixer
    action:
      type: substitute
      substitutions:
        equipment:
          stand mixer: [hand mixer, whisk and bowl (requires more effort)]
      reason: Alternative equipment for mixing

  # ============================================================================
  # CASCADE RULES - Rules that fire based on state changes (Forward-chaining)
  # ============================================================================
  
  - id: cascade_unsuitable_no_score
    name: Don't score unsuitable recipes
    description: If recipe is unsuitable, reset its score to 0
    priority: 10
    category: scoring
    conditions:
      - object: recipe
        attribute: suitable_for_user
        operator: "=="
        value: false
    action:
      type: score
      score_delta: -1000
      reason: Recipe is not suitable for user
  
  - id: cascade_suggest_alternative_for_excluded
    name: Suggest alternatives when recipe excluded
    description: When recipe excluded due to allergies, suggest similar recipes
    priority: 5
    category: substitution
    conditions:
      - object: recipe
        attribute: suitable_for_user
        operator: "=="
        value: false
      - object: recipe
        attribute: exclusion_reasons
        operator: contains
        value: allergen
    action:
      type: substitute
      substitutions:
        ingredient:
          general: [Check similar recipes without this allergen]
      reason: Recipe excluded due to allergen - consider alternatives

